<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LabLink - Sistem Peminjaman & Manajemen</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons for modern icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        .main-content::-webkit-scrollbar, .admin-main::-webkit-scrollbar { width: 6px; }
        .main-content::-webkit-scrollbar-thumb, .admin-main::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 20px; }
        .nav-item.active svg, .nav-item.active span { color: #4f46e5; }
        .nav-item.active { border-top-color: #4f46e5; }
        .admin-nav-item.active { background-color: #e0e7ff; color: #3730a3; }
        .feedback-alert { display: none; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem; text-align: center; font-weight: 500; }
        .feedback-alert.success { background-color: #dcfce7; color: #166534; }
        .feedback-alert.error { background-color: #fee2e2; color: #991b1b; }
        input:read-only { background-color: #f3f4f6; cursor: not-allowed; }
        /* Print styles for reports */
        @media print {
            body * { visibility: hidden; }
            #laporan-print-area, #laporan-print-area * { visibility: visible; }
            #laporan-print-area { position: absolute; left: 0; top: 0; width: 100%; }
            .no-print { display: none; }
        }
    </style>
</head>
<body class="bg-gray-200">

    <!-- Universal Authentication Container -->
    <div id="auth-container" class="min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4">
        <!-- Login View -->
        <div id="login-view" class="w-full max-w-md">
            <div class="text-center mb-8"><i data-lucide="building-2" class="mx-auto h-12 w-12 text-indigo-600"></i><h2 class="mt-6 text-3xl font-bold text-gray-900">Selamat Datang di LabLink</h2></div>
            <div id="login-feedback" class="feedback-alert"></div>
            <form id="login-form" class="space-y-4 bg-white p-8 rounded-2xl shadow-lg">
                <select id="login-role" class="block w-full rounded-md border-gray-300 shadow-sm"><option value="Mahasiswa">Mahasiswa</option><option value="Dosen">Dosen</option><option value="Operator">Operator (Admin)</option></select>
                <input id="login-nim" type="text" placeholder="NIM / Username" required class="block w-full rounded-md border-gray-300 shadow-sm">
                <input id="login-password" type="password" placeholder="Password" required class="block w-full rounded-md border-gray-300 shadow-sm">
                <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-md shadow-sm hover:bg-indigo-700">Login</button>
            </form>
            <p class="mt-6 text-center text-sm">Belum punya akun? <a href="#" id="show-register" class="font-semibold text-indigo-600">Daftar di sini</a></p>
        </div>
        <!-- Registration View -->
        <div id="register-view" class="w-full max-w-md hidden">
            <div class="text-center mb-8"><i data-lucide="user-plus" class="mx-auto h-12 w-12 text-indigo-600"></i><h2 class="mt-6 text-3xl font-bold text-gray-900">Buat Akun Baru</h2></div>
            <div id="register-feedback" class="feedback-alert"></div>
            <form id="register-form" class="space-y-4 bg-white p-8 rounded-2xl shadow-lg">
                <select id="register-role" class="block w-full rounded-md border-gray-300 shadow-sm"><option value="Mahasiswa">Mahasiswa</option><option value="Dosen">Dosen</option><option value="Operator">Operator (Admin)</option></select>
                <input id="reg-nama" type="text" placeholder="Nama Lengkap" required class="block w-full rounded-md border-gray-300 shadow-sm">
                <input id="reg-nim" type="text" placeholder="NIM / Username" required class="block w-full rounded-md border-gray-300 shadow-sm">
                <input id="reg-password" type="password" placeholder="Password" required class="block w-full rounded-md border-gray-300 shadow-sm">
                <button type="submit" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-md shadow-sm hover:bg-indigo-700">Daftar</button>
            </form>
            <p class="mt-6 text-center text-sm">Sudah punya akun? <a href="#" id="show-login" class="font-semibold text-indigo-600">Login di sini</a></p>
        </div>
    </div>

    <!-- Student/Dosen App Container -->
    <div id="main-app-container" class="max-w-md mx-auto bg-white shadow-lg min-h-screen flex-col hidden">
        <!-- Header, Main Content, and Navigation for Students -->
    </div>

    <!-- Admin App Container -->
    <div id="admin-app-container" class="h-screen w-full bg-gray-100 flex hidden">
        <!-- Sidebar Navigation for Admin -->
        <aside class="w-64 bg-white shadow-md flex flex-col no-print">
            <div class="p-6 text-center border-b"><h2 class="text-2xl font-bold text-indigo-600">LabLink Admin</h2></div>
            <nav class="flex-1 p-4 space-y-2">
                <a href="#" class="admin-nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 active" data-view="admin-dashboard"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>Dashboard</span></a>
                <a href="#" class="admin-nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100" data-view="admin-requests"><i data-lucide="file-check-2" class="w-5 h-5"></i><span>Pengajuan</span></a>
                <a href="#" class="admin-nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100" data-view="admin-users"><i data-lucide="users" class="w-5 h-5"></i><span>Kelola User</span></a>
                <a href="#" class="admin-nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100" data-view="admin-inventory"><i data-lucide="archive" class="w-5 h-5"></i><span>Inventaris</span></a>
                <a href="#" class="admin-nav-item flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100" data-view="admin-reports"><i data-lucide="printer" class="w-5 h-5"></i><span>Laporan</span></a>
            </nav>
            <div class="p-4 border-t"><button id="admin-logout-btn" class="w-full flex items-center justify-center space-x-2 p-3 bg-red-50 text-red-600 rounded-lg hover:bg-red-100"><i data-lucide="log-out" class="w-5 h-5"></i><span>Log Out</span></button></div>
        </aside>

        <!-- Main Admin Content Area -->
        <main class="flex-1 flex flex-col">
            <header class="bg-white shadow-sm p-4 no-print"><h1 id="admin-header-title" class="text-xl font-semibold">Dashboard</h1></header>
            <div class="flex-1 p-6 overflow-y-auto admin-main">
                <!-- 1. Admin Dashboard View -->
                <div id="admin-dashboard-view" class="admin-view">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-gray-500">Pengajuan Baru</h3><p id="metric-requests" class="text-3xl font-bold">0</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-gray-500">Total User</h3><p id="metric-users" class="text-3xl font-bold">0</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-gray-500">Item Inventaris</h3><p id="metric-inventory" class="text-3xl font-bold">0</p></div>
                        <div class="bg-white p-6 rounded-lg shadow"><h3 class="text-gray-500">Laporan Masuk</h3><p id="metric-issues" class="text-3xl font-bold">0</p></div>
                    </div>
                </div>
                <!-- 2. Loan Requests View -->
                <div id="admin-requests-view" class="admin-view hidden"><div id="requests-list" class="space-y-4"></div></div>
                <!-- 3. User Management View -->
                <div id="admin-users-view" class="admin-view hidden bg-white p-6 rounded-lg shadow"><div id="users-table-container"></div></div>
                <!-- 4. Inventory Management View -->
                <div id="admin-inventory-view" class="admin-view hidden bg-white p-6 rounded-lg shadow"><div id="inventory-table-container"></div></div>
                <!-- 5. Reports View -->
                <div id="admin-reports-view" class="admin-view hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <button id="print-report-btn" class="mb-4 bg-indigo-600 text-white font-semibold py-2 px-4 rounded-md shadow-sm hover:bg-indigo-700 no-print">Cetak Laporan</button>
                        <div id="laporan-print-area"><div id="reports-table-container"></div></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
    // Simplified script for demonstration. Production would need a proper framework.
    document.addEventListener('DOMContentLoaded', function () {
        lucide.createIcons();

        // --- DATABASE SIMULATION ---
        // Initialize with some default data if empty
        const initDB = () => {
            if (!localStorage.getItem('users')) {
                const defaultAdmin = { nama: 'Admin Operator', nim: 'admin', password: 'admin', role: 'Operator' };
                const defaultStudent = { nama: 'Budi Mahasiswa', nim: '123', password: '123', role: 'Mahasiswa' };
                localStorage.setItem('users', JSON.stringify([defaultAdmin, defaultStudent]));
            }
            if (!localStorage.getItem('peminjaman')) { localStorage.setItem('peminjaman', JSON.stringify([])); }
            if (!localStorage.getItem('inventory')) {
                const defaultInventory = [ { id: Date.now(), name: 'PC Core i5', qty: 20, condition: 'Baik' } ];
                localStorage.setItem('inventory', JSON.stringify(defaultInventory));
            }
        };
        initDB();

        // --- AUTH LOGIC ---
        const authContainer = document.getElementById('auth-container');
        const studentApp = document.getElementById('main-app-container');
        const adminApp = document.getElementById('admin-app-container');
        const loginView = document.getElementById('login-view');
        const registerView = document.getElementById('register-view');

        document.getElementById('show-register').addEventListener('click', e => { e.preventDefault(); loginView.classList.add('hidden'); registerView.classList.remove('hidden'); });
        document.getElementById('show-login').addEventListener('click', e => { e.preventDefault(); registerView.classList.add('hidden'); loginView.classList.remove('hidden'); });
        
        document.getElementById('login-form').addEventListener('submit', e => {
            e.preventDefault();
            const users = JSON.parse(localStorage.getItem('users'));
            const username = document.getElementById('login-nim').value;
            const password = document.getElementById('login-password').value;
            const role = document.getElementById('login-role').value;
            const user = users.find(u => u.nim === username && u.password === password && u.role === role);
            
            if (user) {
                sessionStorage.setItem('loggedInUser', JSON.stringify(user));
                if (user.role === 'Operator') { showAdminApp(); } 
                else { /* showStudentApp(); */ alert('Tampilan Mahasiswa/Dosen belum diimplementasikan di versi ini.'); }
            } else {
                alert('Username, password, atau peran salah.');
            }
        });

        document.getElementById('register-form').addEventListener('submit', e => {
            e.preventDefault();
            const users = JSON.parse(localStorage.getItem('users'));
            const newUser = {
                nama: document.getElementById('reg-nama').value,
                nim: document.getElementById('reg-nim').value,
                password: document.getElementById('reg-password').value,
                role: document.getElementById('register-role').value,
            };
            if(users.find(u => u.nim === newUser.nim)) { alert('Username sudah ada.'); return; }
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            alert('Registrasi berhasil!');
            loginView.classList.remove('hidden');
            registerView.classList.add('hidden');
        });

        const logout = () => {
            sessionStorage.removeItem('loggedInUser');
            adminApp.classList.add('hidden');
            studentApp.classList.add('hidden');
            authContainer.classList.remove('hidden');
        };

        document.getElementById('admin-logout-btn').addEventListener('click', logout);
        
        // --- ADMIN APP LOGIC ---
        const adminNavItems = document.querySelectorAll('.admin-nav-item');
        const adminViews = document.querySelectorAll('.admin-view');
        const adminHeaderTitle = document.getElementById('admin-header-title');

        const showAdminApp = () => {
            authContainer.classList.add('hidden');
            adminApp.classList.remove('hidden');
            renderAdminDashboard();
            renderAllAdminViews();
        };

        const renderAllAdminViews = () => {
            renderUserManagement();
            renderLoanRequests();
            renderInventory();
            renderReports();
        };

        adminNavItems.forEach(item => {
            item.addEventListener('click', e => {
                e.preventDefault();
                const viewName = item.dataset.view;
                adminNavItems.forEach(nav => nav.classList.remove('active'));
                adminViews.forEach(view => view.classList.add('hidden'));
                item.classList.add('active');
                document.getElementById(`${viewName}-view`).classList.remove('hidden');
                adminHeaderTitle.textContent = item.querySelector('span').textContent;
            });
        });

        // Dashboard
        const renderAdminDashboard = () => {
            document.getElementById('metric-requests').textContent = JSON.parse(localStorage.getItem('peminjaman')).filter(p => p.status === 'Pending').length;
            document.getElementById('metric-users').textContent = JSON.parse(localStorage.getItem('users')).length;
            document.getElementById('metric-inventory').textContent = JSON.parse(localStorage.getItem('inventory')).length;
            document.getElementById('metric-issues').textContent = 0; // Placeholder
        };
        
        // User Management
        const renderUserManagement = () => {
            const users = JSON.parse(localStorage.getItem('users'));
            const container = document.getElementById('users-table-container');
            container.innerHTML = `<table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Nama</th><th>Username</th><th>Peran</th><th>Aksi</th></tr></thead><tbody>
                ${users.map(user => `
                    <tr class="border-b">
                        <td class="p-2">${user.nama}</td><td>${user.nim}</td><td>${user.role}</td>
                        <td><button class="text-indigo-600 hover:underline" onclick="resetPassword('${user.nim}')">Reset Password</button></td>
                    </tr>`).join('')}
            </tbody></table>`;
        };
        window.resetPassword = (nim) => {
            if(confirm(`Yakin ingin reset password untuk user ${nim}? Password akan menjadi "123456".`)){
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.nim === nim);
                if (userIndex > -1) {
                    users[userIndex].password = '123456';
                    localStorage.setItem('users', JSON.stringify(users));
                    alert('Password berhasil direset.');
                    renderUserManagement();
                }
            }
        };

        // Loan Requests
        const renderLoanRequests = () => {
             // Mock data for requests
            const requests = [
                { id: 1, userName: 'Budi Mahasiswa', lab: 'Lab Pemrograman 1', date: '2025-09-11', time: '13:00-15:00', status: 'Pending' }
            ];
            const list = document.getElementById('requests-list');
            list.innerHTML = requests.map(r => `
                <div class="bg-white p-4 rounded-lg shadow flex justify-between items-center">
                    <div>
                        <p class="font-bold">${r.userName} - <span class="font-normal">${r.lab}</span></p>
                        <p class="text-sm text-gray-600">${r.date} | ${r.time}</p>
                    </div>
                    <div class="space-x-2">
                        <button class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">Approve</button>
                        <button class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-sm">Reject</button>
                    </div>
                </div>
            `).join('');
            if(requests.length === 0) list.innerHTML = `<p class="text-center text-gray-500">Tidak ada pengajuan baru.</p>`;
        };

        // Inventory
        const renderInventory = () => {
             const inventory = JSON.parse(localStorage.getItem('inventory'));
             const container = document.getElementById('inventory-table-container');
             container.innerHTML = `<table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Nama Alat</th><th>Jumlah</th><th>Kondisi</th></tr></thead><tbody>
                ${inventory.map(item => `
                    <tr class="border-b"><td class="p-2">${item.name}</td><td>${item.qty}</td><td><span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">${item.condition}</span></td></tr>
                `).join('')}
             </tbody></table>`;
        };

        // Reports
        const renderReports = () => {
            const container = document.getElementById('reports-table-container');
            container.innerHTML = `
                <h2 class="text-2xl font-bold mb-4">Laporan Peminjaman Lab</h2>
                <p class="mb-4">Periode: 1 Sep 2025 - 10 Sep 2025</p>
                <table class="w-full text-left"><thead><tr class="border-b"><th class="p-2">Tanggal</th><th>Nama</th><th>Lab</th><th>Waktu</th><th>Status</th></tr></thead>
                <tbody>
                    <tr class="border-b"><td class="p-2">2025-09-10</td><td>Budi Mahasiswa</td><td>Lab Pemrograman 1</td><td>09:00-11:00</td><td>Disetujui</td></tr>
                </tbody></table>`;
        };

        document.getElementById('print-report-btn').addEventListener('click', () => { window.print(); });

        // --- INITIAL CHECK ---
        const checkLoginStatus = () => {
            const userJson = sessionStorage.getItem('loggedInUser');
            if (userJson) {
                const user = JSON.parse(userJson);
                if (user.role === 'Operator') showAdminApp();
                else { /* showStudentApp(); */ }
            } else {
                authContainer.classList.remove('hidden');
            }
        };

        checkLoginStatus();
    });
    </script>
</body>
</html>

